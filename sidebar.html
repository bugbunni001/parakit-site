<div class="sidebar-header">MENU</div>

<div class="menu">
    <a href="index.html">🏠 หน้าหลัก</a>

    <div class="item" id="menu-credit">
        <button type="button" class="drop-btn" onclick="toggleDrop(this, 'credit')">
            📊 บันทึกสินเชื่อ <span class="arrow">▶</span>
        </button>
        <div class="sub">
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSerK-IQFH4StGmvrOxb8M2DOC9VyrToSycYBxWrzSVOq67SOw/viewform" target="_blank">📈 ลงสินเชื่อส่วนกลาง</a>
            <a href="https://lookerstudio.google.com/reporting/8eee598b-7f10-4d88-8162-8ac554e50b9e" target="_blank">📑 Report สินเชื่อส่วนกลาง</a>
        </div>
    </div>

    <a href="download.html">⬇️ ดาวน์โหลด</a>

    <div class="item" id="menu-branch">
        <button type="button" class="drop-btn" onclick="toggleDrop(this, 'branch')">
            📍 เฉพาะประชาอุทิศ <span class="arrow">▶</span>
        </button>
        <div class="sub">
            <a href="schedule_dec25.html">📆 ตารางงาน ธ.ค. 25</a>
            <a href="schedule_jan26.html">📆 ตารางงาน ม.ค. 26</a>
            <a href="mat.html">📱 เช็ค Mat เครื่อง</a>
            <a href="input_sale.html">✏️ ลงยอดขาย</a>
            <a href="report_sale.html">📑 รายงานยอดขาย</a>
            <a href="report_sale.html">📑 รายงานยอดขาย Shop</a>
            <a href="commission.html">💰 คำนวณค่าคอม</a>
            <a href="target.html">🆚 Target รายบุคคล</a>
        </div>
    </div>
</div>

<script>
    // 1. ฟังก์ชันโหลด Sidebar เข้ามาในหน้าเว็บ
    function includeSidebar() {
        const version = new Date().getTime(); // ป้องกัน Cache
        fetch('sidebar.html?v=' + version)
            .then(response => {
                if (!response.ok) throw new Error('ไม่พบไฟล์ sidebar.html');
                return response.text();
            })
            .then(data => {
                document.getElementById('sidebar').innerHTML = data;
                // หลังจากโหลดเสร็จ ให้คืนค่าเมนูที่เปิดค้างไว้
                restoreMenuState();
            })
            .catch(err => console.warn("Sidebar Load Error:", err));
    }

    // 2. ฟังก์ชันเปิด-ปิดแถบ Sidebar (ฝั่งซ้าย)
    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("show");
        document.getElementById("overlay").classList.toggle("show");
    }

    // 3. ฟังก์ชัน กาง-หุบ เมนูย่อย (Dropdown)
    // ใช้ window. เพื่อให้มั่นใจว่าฟังก์ชันเรียกใช้ได้แม้โหลดผ่าน Fetch
    window.toggleDrop = function(btn, id) {
        const item = btn.closest('.item'); 
        if (!item) return;

        // สลับ Class 'open'
        const isOpen = item.classList.toggle("open");
        
        // บันทึกสถานะลง localStorage
        if (id) {
            localStorage.setItem('menu-' + id, isOpen);
        }
    }

    // 4. ฟังก์ชันคืนค่าสถานะเมนูที่เคยเปิดไว้เมื่อ Refresh หน้า
    function restoreMenuState() {
        const menus = ['credit', 'branch']; 
        menus.forEach(id => {
            if (localStorage.getItem('menu-' + id) === 'true') {
                const menuEl = document.getElementById('menu-' + id);
                if (menuEl) menuEl.classList.add('open');
            }
        });
    }

    // เริ่มทำงานเมื่อโหลดหน้าเสร็จ
    window.onload = includeSidebar;
</script>

