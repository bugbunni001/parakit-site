<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Performance Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        :root { 
            --primary: #5bb7aa; --bg: #f5f7fa; --text-dark: #2d3748; --white: #ffffff; 
            --sidebar-width: 260px; --sidebar-bg: #1e293b; --sidebar-hover: #334155;
            --sidebar-text: #cbd5e1; --success: #059669; --danger: #dc2626;
            --pdf: #e11d48; --excel: #166534; --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif !important; }
        html, body { margin: 0; padding: 0; width: 100%; background-color: var(--bg); color: var(--text-dark); min-height: 100vh; overflow-x: hidden; }
        body { display: flex; }

        /* --- SIDEBAR STYLE --- */
        #sidebar-container { 
            width: var(--sidebar-width); 
            background: var(--sidebar-bg); 
            height: 100vh; 
            position: fixed; 
            left: 0; top: 0; 
            transition: transform 0.3s ease; 
            z-index: 2000; 
            overflow-y: auto; 
            box-shadow: 4px 0 15px rgba(0,0,0,0.2); 
        }
        .sidebar-header { padding: 20px; color: white; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .menu-list { list-style: none; padding: 0; margin: 0; }
        .menu-item { border-bottom: 1px solid rgba(255,255,255,0.05); }
        .menu-link { 
            display: flex; align-items: center; padding: 15px 20px; 
            color: var(--sidebar-text); text-decoration: none; transition: 0.3s;
            cursor: pointer;
        }
        .menu-link:hover { background: var(--sidebar-hover); color: var(--primary); }
        .menu-link i { margin-right: 10px; width: 20px; }

        /* --- MAIN CONTENT --- */
        .main-content { flex-grow: 1; margin-left: var(--sidebar-width); padding: 15px; width: calc(100% - var(--sidebar-width)); transition: var(--transition); }
        body.collapsed #sidebar-container { transform: translateX(-100%); }
        body.collapsed .main-content { margin-left: 0; width: 100%; }

        @media (max-width: 900px) { 
            #sidebar-container { transform: translateX(-100%); } 
            .main-content { margin-left: 0 !important; width: 100% !important; } 
            body.show-sidebar #sidebar-container { transform: translateX(0); }
        }

        /* --- NEW LOADING UI --- */
        .loading { 
            position: fixed; inset: 0; 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            display: none; flex-direction: column; justify-content: center; align-items: center; 
            z-index: 9999; 
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite;
            box-shadow: 0 0 15px rgba(91, 183, 170, 0.3);
        }
        .loading-text { margin-top: 15px; font-weight: 500; color: var(--primary); animation: pulse 1.5s infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* --- DASHBOARD ELEMENTS --- */
        .header-bar { background: var(--white); padding: 15px 20px; border-radius: 14px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); flex-wrap: wrap; gap: 15px; }
        .btn-fetch { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 500; }
        .card { background: var(--white); border-radius: 15px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.03); margin-bottom: 15px; }
        .card-header { padding: 12px 18px; color: white; font-weight: 600; background: var(--primary); display: flex; justify-content: space-between; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1500; backdrop-filter: blur(3px); }
        body.show-sidebar .overlay { display: block; }
    </style>
</head>
<body id="mainBody">

<div class="loading" id="loader">
    <div class="spinner"></div>
    <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...</div>
</div>

<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

<aside id="sidebar-container">
    <div class="sidebar-header">
        <h3 style="margin:0; color:var(--primary);">Menu System</h3>
    </div>
    <nav class="menu-list">
        <div class="menu-item">
            <a href="#" class="menu-link" onclick="location.reload()">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å Dashboard</a>
        </div>
        <div class="menu-item">
            <a href="#" class="menu-link">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</a>
        </div>
        <div class="menu-item">
            <a href="#" class="menu-link">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</a>
        </div>
        <div class="menu-item">
            <a href="#" class="menu-link">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </nav>
</aside>

<main class="main-content">
    <div class="container">
        <div class="header-bar">
            <div style="display:flex; align-items:center; gap:12px;">
                <button onclick="toggleSidebar()" style="background:var(--sidebar-bg); color:white; border:none; padding:10px 14px; border-radius:10px; cursor:pointer;">‚ò∞</button>
                <h2 style="margin:0; font-size:18px; color:var(--primary);">Performance Report</h2>
            </div>
            <div class="action-group" style="display:flex; gap:10px; flex-wrap:wrap;">
                <select id="staffSelect" style="padding:10px; border-radius:8px; border:1px solid #ddd;">
                    <option value="‡∏ô‡∏ß‡∏û‡∏•2">üë§ ‡∏ô‡∏ß‡∏û‡∏•</option>
                    <option value="‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£2">üë§ ‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£</option>
                    <option value="‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå2">üë§ ‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå</option>
                </select>
                <select id="daySelect" style="padding:10px; border-radius:8px; border:1px solid #ddd;">
                    <option value="">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</option>
                    <script>for(let i=1; i<=31; i++) document.write(`<option value="${i}">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${i}</option>`);</script>
                </select>
                <button class="btn-fetch" onclick="loadData()">üöÄ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>

        <div id="noData" style="text-align: center; padding: 60px; color: #a0aec0; background: white; border-radius: 20px; border: 2px dashed #e2e8f0;">
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>"‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"</b></p>
        </div>

        <div id="dashboardData" style="display:none;">
            <div class="card">
                <div class="card-header">üìç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: <span id="labelL"></span></div>
                <div style="padding:20px;">
                    <table style="width:100%; border-collapse: collapse;">
                        <thead><tr style="text-align:left; border-bottom:2px solid #eee;"><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr></thead>
                        <tbody id="summaryBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz0YP6s-i40jOU_BklK3-ly_1nQyJmzBiGY_HhTlcrW5XM-yWr74bXi_XUgywwXmNn8/exec";

    function toggleSidebar() {
        const body = document.getElementById('mainBody');
        if (window.innerWidth <= 900) {
            body.classList.toggle('show-sidebar');
        } else {
            body.classList.toggle('collapsed');
        }
    }

    async function loadData() {
        const loader = document.getElementById('loader');
        const sheet = document.getElementById('staffSelect').value;
        const selectedDay = document.getElementById('daySelect').value;
        
        loader.style.display = 'flex';
        
        try {
            const res = await fetch(`${SCRIPT_URL}?sheetName=${sheet}&targetDay=${selectedDay}`);
            const data = await res.json();
            
            if(data.result === "success") {
                document.getElementById('labelL').innerText = data.staffName;
                document.getElementById('summaryBody').innerHTML = data.summary.map(r => 
                    `<tr><td style="padding:10px; border-bottom:1px solid #eee;">${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>`
                ).join('');
                
                document.getElementById('dashboardData').style.display = 'block';
                document.getElementById('noData').style.display = 'none';
            }
        } catch (e) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
        } finally {
            loader.style.display = 'none';
        }
    }
</script>
</body>
</html>
