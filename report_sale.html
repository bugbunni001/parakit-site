<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif !important; }
        body { margin: 0; background: #f8fafc; color: #334155; }
        
        .content { padding: 20px; min-height: 100vh; }
        .report-card { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Layout ‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ô */
        .tables-grid { 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap; /* ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏à‡∏∞‡∏ï‡∏Å‡∏•‡∏á‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô */
            margin-top: 20px;
        }
        .table-section { flex: 1; min-width: 300px; }

        select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; margin-bottom: 10px; }
        .btn-fetch { width: 100%; padding: 12px; border: none; background: #1e293b; color: white; border-radius: 8px; font-weight: 600; cursor: pointer; }

        /* ‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        table { width: 100%; border-collapse: collapse; font-size: 14px; border: 1px solid #e2e8f0; }
        th { background: #4db6ac; color: white; padding: 10px; }
        td { padding: 8px; border: 1px solid #f1f5f9; text-align: center; }

        /* ‡∏™‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ (Target) */
        .bg-teal { background: #4dd0e1; font-weight: bold; }
        .bg-yellow { background: #ffca28; font-weight: bold; }
        .bg-orange { background: #ff6f00; color: white; font-weight: bold; }
        .bg-gray { background: #bdbdbd; font-weight: bold; }
        .text-red { color: red; font-weight: bold; }

        #loader { text-align: center; display: none; margin: 10px; }
    </style>
</head>
<body>

<main class="content">
    <div class="report-card">
        <h2 style="text-align:center">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h2>
        
        <select id="staffSelect">
            <option value="‡∏ô‡∏ß‡∏û‡∏•2">üë§ ‡∏ô‡∏ß‡∏û‡∏•</option>
            <option value="‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£2">üë§ ‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£</option>
            <option value="‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå2">üë§ ‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå</option>
        </select>
        
        <button class="btn-fetch" onclick="getPersonalSales()">üîÑ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <div id="loader">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

        <div class="tables-grid" id="mainDisplay" style="display:none;">
            <div class="table-section">
                <h3 style="font-size:15px;">üìç ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h3>
                <table>
                    <thead>
                        <tr style="background:#f1f5f9;"><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
                    </thead>
                    <tbody id="salesBody"></tbody>
                </table>
            </div>

            <div class="table-section">
                <h3 style="font-size:15px;">üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Target)</h3>
                <table id="targetTable">
                    <tbody id="targetBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwY7FVcy9hzmCsP-PP5tIsNh6t45wHkIX3JYCoBZKXRsA58vVmDT9k7rxdPRRUWHQwc_g/exec"; 

    async function getPersonalSales() {
        const sheetName = document.getElementById('staffSelect').value;
        const loader = document.getElementById('loader');
        const mainDisplay = document.getElementById('mainDisplay');
        
        loader.style.display = 'block';
        mainDisplay.style.display = 'none';

        try {
            const response = await fetch(`${SCRIPT_URL}?sheetName=${encodeURIComponent(sheetName)}`);
            const data = await response.json();

            // 1. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ (Sales)
            const salesBody = document.getElementById('salesBody');
            salesBody.innerHTML = "";
            data.sales.slice(1).forEach(row => {
                if(!row[0]) return;
                let tr = `<tr><td>${row[0]}</td><td>${row[1]||0}</td><td>${row[2]||0}</td></tr>`;
                salesBody.innerHTML += tr;
            });

            // 2. ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ (Target F4:G23)
            const targetBody = document.getElementById('targetBody');
            targetBody.innerHTML = "";
            data.targets.forEach(row => {
                if(!row[0] && !row[1]) return;
                let label = row[0];
                let val = row[1];
                let rowClass = "";
                let valClass = "";

                // ‡πÉ‡∏™‡πà‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
                if(label.includes("Focus")) rowClass = "bg-teal";
                else if(label.includes("Target NEW")) rowClass = "bg-yellow";
                else if(label.includes("Target BDBC")) rowClass = "bg-orange";
                else if(label.includes("Target Apple")) rowClass = "bg-gray";
                else if(label.includes("Target SmartPhone")) rowClass = "bg-teal";

                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ Actual ‡πÉ‡∏ô Focus ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á
                if(["‡∏£‡∏≤‡∏´‡∏π","‡∏û‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß","MyPlan"].some(k => label.includes(k))) valClass = "text-red";

                if(rowClass !== "") {
                    targetBody.innerHTML += `<tr class="${rowClass}"><td colspan="2">${label}</td></tr>`;
                } else {
                    targetBody.innerHTML += `<tr><td style="text-align:left">${label}</td><td class="${valClass}">${val}</td></tr>`;
                }
            });

            mainDisplay.style.display = 'flex';
        } catch (e) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message);
        } finally {
            loader.style.display = 'none';
        }
    }
</script>
</body>
</html>
