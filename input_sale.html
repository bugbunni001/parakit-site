<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* ===== SETUP & SIDEBAR ROLLOVER ===== */
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif !important; }
        body { margin: 0; background: #f8fafc; padding-bottom: 100px; color: #334155; }

        .top-toggle { position: fixed; top: 15px; left: 15px; z-index: 1400; width: 45px; height: 45px; border-radius: 12px; border: none; background: #1e293b; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .sidebar { position: fixed; top: 0; left: 0; width: 260px; height: 100vh; background: #1e293b; color: #fff; transform: translateX(-260px); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; padding-top: 60px; }
        .sidebar.show { transform: translateX(0); }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π + Rollover */
        .sidebar-header { padding: 20px; font-weight: 600; font-size: 18px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .menu-item { width: 100%; padding: 15px 25px; display: flex; align-items: center; color: #cbd5e1; text-decoration: none; transition: all 0.3s ease; border-left: 4px solid transparent; cursor: pointer; }
        .menu-item:hover { background: #334155; color: #fff; padding-left: 35px; border-left: 4px solid #5bbf8a; }

        .overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); display: none; backdrop-filter: blur(4px); z-index: 1500; }
        .overlay.show { display: block; }
        .content { padding: 80px 20px; transition: margin-left .3s; }
        @media(min-width:769px) { .sidebar { transform: translateX(0); } .content { margin-left: 260px; } .top-toggle { display: none; } }

        /* ===== BOX STYLES ===== */
        .box { max-width: 650px; margin: 0 auto 30px; background: #fff; padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .form-row { display: grid; grid-template-columns: 140px 1fr; align-items: center; margin-bottom: 15px; gap: 12px; }
        label { font-weight: 500; font-size: 14px; color: #64748b; text-align: right; }
        input, select { width: 100%; padding: 10px; border: 1.5px solid #e2e8f0; border-radius: 10px; outline: none; background: #f8fafc; }
        
        .btn-submit { width: 100%; padding: 15px; background: #5bbf8a; color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-submit:hover { background: #4eab7a; transform: translateY(-2px); }
        .btn-fetch { width: 100%; padding: 15px; background: #1e293b; color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; margin-top: 10px; }

        /* ===== TABLE STYLES (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥) ===== */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; border-radius: 12px; overflow: hidden; display: none; border: 1px solid #e2e8f0; }
        th { background-color: #4db6ac; color: white; padding: 12px; font-weight: 600; }
        td { padding: 10px; border: 1px solid #e2e8f0; text-align: center; font-size: 14px; }
        .bg-new { background-color: #c8e6c9 !important; font-weight: 600; }
        .bg-bdbc { background-color: #d1ecf1 !important; font-weight: 600; }
        .device-header { background-color: #00bcd4 !important; color: white; }
    </style>
</head>
<body>

<button class="top-toggle" onclick="toggleSidebar()">‚ò∞</button>
<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">MENU</div>
    <div class="menu-item" onclick="location.reload()">üè† ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
    <div class="menu-item" onclick="toggleSidebar()">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
    <div class="menu-item" onclick="toggleSidebar()">üì± ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
</aside>

<main class="content">
    <div class="box">
        <h3 style="text-align:center;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</h3>
        <div class="form-row"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="date"></div>
        <div class="form-row">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
            <select id="staff">
                <option value="‡∏ô‡∏ß‡∏û‡∏•">‡∏ô‡∏ß‡∏û‡∏•</option>
                <option value="‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£">‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£</option>
                <option value="‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå">‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå</option>
            </select>
        </div>
        <div class="form-row">
            <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
            <select id="type">
                <option>New Sim Only</option>
                <option>New Rahu</option>
                <option>BDBC</option>
            </select>
        </div>
        <div class="form-row"><label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</label><input type="number" id="amount" placeholder="0"></div>
        <button class="btn-submit" onclick="submitData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <div class="box">
        <h3 style="text-align:center;">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
        <select id="employeeSelect" style="margin-bottom:10px;">
            <option value="‡∏ô‡∏ß‡∏û‡∏•2">‡∏ô‡∏ß‡∏û‡∏•</option>
            <option value="‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£2">‡∏õ‡∏¥‡∏¢‡∏∞‡∏û‡∏£</option>
            <option value="‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå2">‡∏Å‡∏£‡∏ó‡∏±‡∏Å‡∏©‡πå</option>
        </select>
        <button class="btn-fetch" onclick="getSalesData()">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>

        <table id="salesTable">
            <thead>
                <tr><th id="empTitle" colspan="3">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</th></tr>
                <tr style="background:#fff;"><td style="font-weight:600;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td><td style="font-weight:600;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</td><td style="font-weight:600;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</td></tr>
            </thead>
            <tbody id="salesBody"></tbody>
        </table>

        <table id="deviceTable" style="margin-top:20px;"><tbody id="deviceBody"></tbody></table>
    </div>
</main>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMxGbkc76z0_uaPPxqEhXDDTze4MklQqjvePVaSk9BSymCJAXhBdLE6VbhAqFxkfp11w/exec";

    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("show");
        document.getElementById("overlay").classList.toggle("show");
    }

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    async function submitData() {
        const data = {
            date: document.getElementById('date').value,
            staff: document.getElementById('staff').value,
            type: document.getElementById('type').value,
            amount: document.getElementById('amount').value
        };

        try {
            const response = await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÑ‡∏õ App Script
                body: JSON.stringify(data)
            });
            alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            document.getElementById('amount').value = "";
        } catch (e) {
            alert("‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + e.message);
        }
    }

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ã‡πâ‡∏≥)
    async function getSalesData() {
        const sheetName = document.getElementById('employeeSelect').value;
        const ts = new Date().getTime();

        try {
            const res = await fetch(`${SCRIPT_URL}?sheetName=${encodeURIComponent(sheetName)}&t=${ts}`);
            const data = await res.json();

            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ (‡∏ï‡∏±‡∏î‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å)
            const salesBody = document.getElementById('salesBody');
            salesBody.innerHTML = "";
            const mainData = data.slice(5, 15); // ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
            mainData.forEach(row => {
                const tr = document.createElement('tr');
                if (row[1] && row[1].includes("‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î New")) tr.className = 'bg-new';
                if (row[1] && row[1].includes("‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î BDBC")) tr.className = 'bg-bdbc';
                tr.innerHTML = `<td>${row[1] || ""}</td><td>${row[2] || "0"}</td><td>${row[3] || "0"}</td>`;
                salesBody.appendChild(tr);
            });

            // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Device (B22:D25)
            const deviceBody = document.getElementById('deviceBody');
            deviceBody.innerHTML = "";
            const deviceData = data.slice(21, 25);
            deviceData.forEach((row, i) => {
                const tr = document.createElement('tr');
                if (i === 0) tr.innerHTML = `<th class="device-header" colspan="3">${row[1]}</th>`;
                else tr.innerHTML = `<td>${row[1] || ""}</td><td>${row[2] || "0"}</td><td>${row[3] || "0"}</td>`;
                deviceBody.appendChild(tr);
            });

            document.getElementById('salesTable').style.display = 'table';
            document.getElementById('deviceTable').style.display = 'table';
        } catch (e) {
            alert("‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
    }

    document.getElementById('date').value = new Date().toISOString().split('T')[0];
</script>
</body>
</html>

