<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Target BigC Prachauthit</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --sidebar-w: 280px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; }
        body { margin: 0; background: #f8fafc; overflow-x: hidden; display: flex; }

        /* ===== SIDEBAR SYSTEM (บังคับสถานะด้วย Class .active) ===== */
        .sidebar { 
            position: fixed; top: 0; left: 0; width: var(--sidebar-w); height: 100vh; 
            background: #0f172a; color: #fff; z-index: 9999;
            transform: translateX(-100%); transition: var(--transition);
            box-shadow: 10px 0 30px rgba(0,0,0,0.3);
        }
        /* ถ้ามี active ให้กางออกมา */
        body.menu-open .sidebar { transform: translateX(0); }

        .overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); 
            display: none; z-index: 9998; backdrop-filter: blur(4px); 
        }
        body.menu-open .overlay { display: block; }

        .content-wrapper { flex: 1; width: 100%; transition: var(--transition); }
        
        @media(min-width: 992px) {
            .sidebar { transform: translateX(0); }
            .content-wrapper { margin-left: var(--sidebar-w); }
            .menu-toggle, .close-sidebar-btn { display: none !important; }
        }

        /* ปุ่มเปิด-ปิด */
        .top-nav { padding: 15px 20px; background: #fff; display: flex; align-items: center; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 1000; }
        .menu-toggle { width: 45px; height: 45px; cursor: pointer; display: flex; align-items: center; justify-content: center; background: #f1f5f9; border-radius: 10px; font-size: 1.2rem; margin-right: 15px; }
        .close-sidebar-btn { padding: 15px; text-align: right; cursor: pointer; font-size: 1.5rem; color: #94a3b8; }

        /* ส่วนประกอบอื่นๆ (คงเดิมเพื่อความสวยงาม) */
        .status-pill { display: flex; align-items: center; gap: 8px; font-size: 13px; background: #fff; padding: 6px 14px; border-radius: 50px; border: 1px solid #e2e8f0; margin-left: auto; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #cbd5e1; }
        .dot.pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(2.5); opacity: 0; } }
        
        .main-container { padding: 25px; max-width: 1200px; margin: 0 auto; }
        .target-card { background: #fff; border-radius: 20px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border-top: 5px solid var(--primary); }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        input[type="text"] { width: 100px; text-align: right; padding: 8px; border-radius: 8px; border: 1.5px solid #e2e8f0; font-weight: 600; }
        .staff-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-save { background: #059669; color: #fff; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body id="bodyNode">

<div class="overlay" onclick="toggleMenu(false)"></div>

<aside class="sidebar">
    <div class="close-sidebar-btn" onclick="toggleMenu(false)">
        <i class="fa-solid fa-xmark"></i>
    </div>
    <div id="sidebar-content">
        <div style="padding: 20px; color: #94a3b8;">กำลังโหลดเมนู...</div>
    </div>
</aside>

<div class="content-wrapper">
    <nav class="top-nav">
        <div class="menu-toggle" onclick="toggleMenu(true)">
            <i class="fa-solid fa-bars-staggered"></i>
        </div>
        <h2 style="font-size: 18px; margin: 0;">BigC Prachauthit</h2>
        <div class="status-pill">
            <div class="dot" id="sync-dot"></div>
            <span id="status-text">กำลังโหลด...</span>
        </div>
    </nav>

    <main class="main-container">
        <div style="display:flex; justify-content: space-between; background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 20px;">
            <span id="modeLabel" style="font-weight: 600; color: #64748b;">READ ONLY</span>
            <input type="checkbox" id="editToggle" onchange="toggleEditMode()">
        </div>

        <div class="grid-container">
            <div class="target-card">
                <h3>Postpay</h3>
                <div class="staff-item"><span>นวพล</span><input type="text" id="pp_nawa_n" class="data-input" oninput="handleInput(this)" readonly></div>
                <div class="staff-item"><span>ปิยะพร</span><input type="text" id="pp_piya_n" class="data-input" oninput="handleInput(this)" readonly></div>
                <div class="staff-item"><span>กรทักษ์</span><input type="text" id="pp_korn_n" class="data-input" oninput="handleInput(this)" readonly></div>
            </div>

            <div class="target-card" style="border-top-color: #7c3aed;">
                <h3>Device</h3>
                <div class="staff-item"><span>นวพล</span><input type="text" id="dev_nawa_a" class="data-input" oninput="handleInput(this)" readonly></div>
                <div class="staff-item"><span>ปิยะพร</span><input type="text" id="dev_piya_a" class="data-input" oninput="handleInput(this)" readonly></div>
                <div class="staff-item"><span>กรทักษ์</span><input type="text" id="dev_korn_a" class="data-input" oninput="handleInput(this)" readonly></div>
            </div>
        </div>

        <button class="btn-save" id="saveBtn" onclick="saveAll()" disabled>บันทึกข้อมูล</button>
    </main>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz4jD9tgF3eR-j5xEyq2HUlQ2r7eYyHFo7pwvkV_EHBLz33Srnez2Vy9q7i-biUvtvmgQ/exec";

    // ===== แก้ไขเรื่องกาง/หุบเมนู ตรงนี้! =====
    function toggleMenu(isOpen) {
        if (isOpen) {
            document.body.classList.add('menu-open');
        } else {
            document.body.classList.remove('menu-open');
        }
    }

    // โหลด Sidebar จากไฟล์ภายนอก
    async function loadSidebar() {
        try {
            const res = await fetch('sidebar.html');
            if (res.ok) {
                document.getElementById('sidebar-content').innerHTML = await res.text();
            }
        } catch (e) { console.warn("Sidebar file not found"); }
    }

    // ฟังก์ชันช่วยอื่นๆ
    function formatNumber(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
    function parseNumber(s) { return parseInt(s.replace(/,/g, '')) || 0; }

    function handleInput(input) {
        input.value = formatNumber(input.value.replace(/[^0-9]/g, ''));
    }

    function toggleEditMode() {
        const isEdit = document.getElementById('editToggle').checked;
        document.querySelectorAll('.data-input').forEach(i => i.readOnly = !isEdit);
        document.getElementById('saveBtn').disabled = !isEdit;
        document.getElementById('modeLabel').innerText = isEdit ? "EDIT MODE" : "READ ONLY";
        document.getElementById('modeLabel').style.color = isEdit ? "#2563eb" : "#64748b";
    }

    async function loadData() {
        const dot = document.getElementById('sync-dot');
        dot.classList.add('pulse');
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            Object.keys(data).forEach(k => {
                const el = document.getElementById(k);
                if (el && el.tagName === 'INPUT') el.value = formatNumber(data[k]);
            });
            dot.style.background = "#10b981";
            document.getElementById('status-text').innerText = "ออนไลน์";
        } catch (e) {
            dot.style.background = "#ef4444";
            document.getElementById('status-text').innerText = "เชื่อมต่อล้มเหลว";
        }
    }

    window.onload = () => {
        loadSidebar();
        loadData();
    };
</script>
</body>
</html>
