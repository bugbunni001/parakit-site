<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå SIMONLY&BUNDLING</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    :root { 
        --success: #10b981; --success-dark: #059669; --success-light: #ecfdf5; 
        --bg: #f8fafc; --white: #ffffff; --text-main: #1e293b; --text-muted: #64748b;
        --sidebar-w: 280px;
    }
    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; }
    body { background: var(--bg); margin: 0; padding: 0; transition: 0.4s; overflow-x: hidden; }
    
    /* Hamburger Button */
    .menu-btn {
        position: fixed; top: 20px; left: 20px; z-index: 1500; 
        background: var(--white); border: none; padding: 12px; border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08); cursor: pointer; transition: 0.3s;
    }
    .menu-btn:hover { transform: scale(1.05); }

    .container { 
        padding: 80px 20px 50px; 
        max-width: 1200px; margin: 0 auto;
        display: flex; flex-direction: column; align-items: center;
    }

    .header { text-align: center; margin-bottom: 40px; }
    .header h1 { color: var(--text-main); font-size: clamp(32px, 5vw, 48px); margin: 0; }
    .header h1 span { color: var(--success); }

    .list { 
        width: 100%; display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
        gap: 20px; display: none; 
    }
    
    .item {
        background: var(--white); padding: 35px 25px; border-radius: 30px;
        display: flex; flex-direction: column; align-items: center;
        box-shadow: 0 4px 20px rgba(0,0,0,0.03); border: 1px solid #edf2f7; transition: 0.3s;
    }
    .item:hover { transform: translateY(-8px); border-color: var(--success); }

    .phone-text { font-size: 34px; font-weight: 600; color: var(--text-main); margin-bottom: 20px; letter-spacing: 1px; }
    .btn-use {
        width: 100%; background: var(--success); color: white; border: none;
        padding: 15px; border-radius: 18px; cursor: pointer; font-weight: 600; font-size: 18px;
    }

    .item.is-used { background: var(--success-light); border-color: var(--success); opacity: 0.8; }
    .item.is-used .phone-text { text-decoration: line-through; color: var(--success-dark); }
    .used-tag { color: var(--success-dark); font-weight: 600; margin-top: 15px; display: none; }
    .item.is-used .used-tag { display: block; }

    /* Modal */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(6px);
        display: none; align-items: center; justify-content: center; z-index: 3000;
    }
    .modal { background: white; padding: 40px; border-radius: 35px; width: 90%; max-width: 400px; text-align: center; }
    .modal-btns { display: flex; gap: 15px; margin-top: 30px; }
    .btn-confirm { background: var(--success); color: white; border: none; flex: 1; padding: 16px; border-radius: 15px; font-weight: 600; cursor: pointer; }
    .btn-cancel { background: #f1f5f9; color: var(--text-muted); border: none; flex: 1; padding: 16px; border-radius: 15px; font-weight: 600; cursor: pointer; }

    #loader { padding: 100px; text-align: center; color: var(--text-muted); }

    @media (max-width: 600px) {
        .container { padding-top: 90px; }
        .list { grid-template-columns: 1fr; }
    }
</style>
</head>
<body id="body">

<?!= include('sidebar'); ?>

<button class="menu-btn" onclick="toggleSidebar()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
</button>

<div class="container">
    <div class="header">
        <h1>üì± <span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></h1>
    </div>

    <div id="loader">‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ö‡∏≠‡∏£‡πå...</div>
    <div class="list" id="list"></div>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal">
        <h3 style="margin-top:0">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå?</h3>
        <p style="color:var(--text-muted)">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Google Sheets ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
        <div class="modal-btns">
            <button class="btn-cancel" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn-confirm" id="confirmBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
    </div>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyesT9AQmPgj5H8k9Vwvl-gz78yO5XKrnsJz2Odvx0JvSBpajN7gEks062JA508zmLsaA/exec";

// Sidebar Toggle & Memory
function toggleSidebar() {
    const sb = document.getElementById("mySidebar");
    const body = document.getElementById("body");
    const isOpen = sb.style.width === "280px";
    
    if(isOpen) {
        sb.style.width = "0";
        body.style.paddingLeft = "0";
        localStorage.setItem("sb_open", "no");
    } else {
        sb.style.width = "280px";
        if(window.innerWidth > 900) body.style.paddingLeft = "280px";
        localStorage.setItem("sb_open", "yes");
    }
}

// Initial Load
window.onload = () => {
    if(localStorage.getItem("sb_open") === "yes" && window.innerWidth > 900) toggleSidebar();
    
    google.script.run.withSuccessHandler(data => {
        document.getElementById("loader").style.display = "none";
        const list = document.getElementById("list");
        list.style.display = "grid";
        
        data.forEach(item => {
            const div = document.createElement("div");
            div.className = "item";
            div.id = `row-${item.row}`;
            div.innerHTML = `
                <div class="phone-text">${item.number}</div>
                <button class="btn-use" id="btn-${item.row}" onclick="openModal(${item.row})">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</button>
                <div class="used-tag">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
            `;
            list.appendChild(div);
        });
    }).getSheetData();
};

function openModal(r) {
    document.getElementById("modalOverlay").style.display = "flex";
    document.getElementById("confirmBtn").onclick = () => use(r);
}

function closeModal() { document.getElementById("modalOverlay").style.display = "none"; }

function use(r) {
    closeModal();
    const btn = document.getElementById(`btn-${r}`);
    btn.disabled = true; btn.textContent = "‚åõ...";
    
    fetch(WEB_APP_URL, { method: "POST", body: JSON.stringify({row: r}) })
    .then(() => {
        document.getElementById(`row-${r}`).classList.add("is-used");
        btn.style.display = "none";
    });
}
</script>
</body>
</html>
